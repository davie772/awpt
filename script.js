var V="work",O="break";class Y extends EventTarget{#w=null;#f=[];#g=0;#z="work";#h=null;#V=null;constructor(f,h,w){super();this.#h=f,this.#f=h,this.#V=w}start(){if(this.#$(),this.#w!==null)clearInterval(this.#w);this.intervalId=setInterval(()=>{this.#$()},1000)}setBreaks(f){this.#f=f}#$(){this.#H()}#H(){let f=new Date,h=this.#g,w=this.#f[this.#g];if(this.#h<w.start&&f>=w.start){this.dispatchElapsed(w.start,"break"),this.#H();return}if(this.#h<w.end&&f>=w.end){if(this.dispatchElapsed(w.end,"work"),this.#g<this.#f.length-1)this.#g+=1;this.#H();return}}getElapsed(f){return f-this.#h}dispatchElapsed(f,h){let w=new Date(Math.min(f.getTime(),this.#V.getTime())),g=this.getElapsed(w),X=new M(g,this.#z);this.dispatchEvent(X),this.#h=w,this.#z=h}}var $=(f,h)=>{let w=new Date;return w.setHours(f),w.setMinutes(h),w.setSeconds(0),w.setMilliseconds(0),w};class q{constructor(f,h){this.start=f,this.end=h}static fromStartAndDuration(f,h){let w=new Date(f.getTime()+h*60000);return new q(f,w)}}class M extends Event{#w;#f;constructor(f,h){super("time-passed");this.#w=f,this.#f=h}get elapsed(){return this.#w}get kind(){return this.#f}}var P=".green{color:green}.red{color:red}#button-section{flex-direction:column;gap:5em;display:flex}#add-button{width:20em;height:20em}#rest-button{width:5em;height:5em;margin-left:5em;display:none}#problem-button{width:3em;height:3em}#sub-button{width:2em;height:2em;margin-left:10em}.hor{flex-direction:row;display:flex}.warn{animation:.3s forwards warnAnim}@keyframes warnAnim{0%{background:#fcc}to{}}#log{white-space:break-spaces}";var c="*,:before,:after,:host{box-sizing:border-box}*,:host{margin:0}";var G=new CSSStyleSheet;G.replaceSync(c);var W=new CSSStyleSheet;W.replaceSync(P);document.adoptedStyleSheets=[W];var N=(f,h)=>{let w=document.createElement("template");w.innerHTML=f;let g=new CSSStyleSheet;return g.replaceSync(h),[w,[G,g]]},R=(f,h,w)=>{let g=f.attachShadow({mode:"open"});return g.adoptedStyleSheets=w,g.appendChild(h.content.cloneNode(!0)),g};var x={};var b="<slot name=time></slot>h";var[i,r]=N(b,x);customElements.define("d-time-fmt",class extends HTMLElement{static observedAttributes=["ms"];constructor(){super();let f=R(this,i,r);this._dHeading=document.createElement("span"),this._dHeading.slot="time",this._dHeading.textContent="NO TIME",this.prepend(this._dHeading)}attributeChangedCallback(f,h,w){this._dHeading.textContent=`${(w/3600000).toFixed(2)}`}});document.addEventListener("keydown",(f)=>{if(f.key==="Enter"||f.keyCode===13)f.preventDefault(),f.stopPropagation()},!0);var F0=document.getElementsByTagName("body")[0];window.addEventListener("blur",()=>{Q.classList.remove("warn")});var J=document.getElementById("log"),s=document.getElementById("timer"),Z=document.getElementById("uph-goal"),L=Z.value,K=1/L;Z.addEventListener("input",()=>{L=Z.value,K=1/L,_()});var u=document.getElementById("nt"),l=document.getElementById("bt"),a=document.getElementById("uph"),I=document.getElementById("udev"),n=document.getElementById("units"),t=document.getElementById("ps"),D=document.getElementById("dev"),Q=document.getElementById("add-button"),e=document.getElementById("problem-button"),f0=document.getElementById("sub-button");Q.addEventListener("click",()=>{z+=1,H.dispatchElapsed(new Date,V)});e.addEventListener("click",()=>{p+=1,H.dispatchElapsed(new Date,V)});f0.addEventListener("click",()=>{z-=1,H.dispatchElapsed(new Date,V)});var w0=$(6,0),h0=$(16,30),g0=[q.fromStartAndDuration($(12,0),30)],H=new Y(w0,g0,h0);H.addEventListener("time-passed",(f)=>{console.log(`${f.kind} â€” ${(f.elapsed/3600000).toFixed(2)}h (${f.elapsed})`);let h=(f.elapsed/60000).toFixed(2);switch(f.kind){case V:C+=f.elapsed,console.log(J),J.textContent=`W ${h}m
${J.textContent}`;break;case O:S+=f.elapsed,J.textContent=`B ${h}m
${J.textContent}`;break}});setInterval(()=>{let h=(H.getElapsed(new Date)/60000).toFixed(3);s.textContent=`${h}m`},100);var y=()=>{console.log(`set break to: ${j.value}:${A.value}`),H.setBreaks([q.fromStartAndDuration($(Number(j.value),Number(A.value)),30)])},j=document.getElementById("brk2-h"),A=document.getElementById("brk2-m");j.addEventListener("input",y);A.addEventListener("input",y);var C=0,S=0,z=0,p=0,F=document.getElementById("units-force");F.addEventListener("input",()=>{z=Number(F.value),_(),console.log("forced units")});var U=(f)=>{if(f<0)return[`${f}`,"red"];return[`+${f}`,"green"]},_=()=>{F.value=z,u.setAttribute("ms",C),l.setAttribute("ms",S),n.textContent=z;let f=C/3600000;console.log(`total: ${f.toFixed(2)}h`);let h=z/f;a.textContent=h.toFixed(2);let w=L*f,g=z-w,[X,v]=U(Math.round(g));I.className=v,I.textContent=X;let T=K*g,[B,E]=U(T.toFixed(2));D.className=E,D.textContent=B,t.textContent=p,Q.classList.add("warn"),setTimeout(()=>{Q.classList.remove("warn")},300),console.log()};H.addEventListener("time-passed",_);H.start();
